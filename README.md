# ğŸ›¡ï¸ è„†å¼±æ€§ç®¡ç†AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ

SIDfmã®è„†å¼±æ€§é€šçŸ¥ãƒ¡ãƒ¼ãƒ«ã‚’è‡ªå‹•ã§è§£æã—ã€SBOMã¨çªåˆã—ã¦æ‹…å½“è€…ã¸é€šçŸ¥ã™ã‚‹ **Vertex AI Agent Engine** å‘ã‘ã®AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã™ã€‚Gmail / Google Sheets / Google Chat ã‚’ä½¿ã£ãŸé‹ç”¨ã‚’å‰æã«ã€å®šæœŸå®Ÿè¡Œã®ã‚¹ã‚­ãƒ£ãƒ³ã‚„éŸ³å£°/ãƒãƒ£ãƒƒãƒˆUIé€£æºã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚

## ä¸»ãªæ©Ÿèƒ½

- **è„†å¼±æ€§æ¤œçŸ¥**: SIDfmãƒ¡ãƒ¼ãƒ«ã‚’ç›£è¦–ã—ã¦æœªèª­ã®é€šçŸ¥ã‚’å–å¾—
- **å½±éŸ¿åˆ†æ**: SBOMã¨ç…§åˆã—ã¦å½±éŸ¿ã‚·ã‚¹ãƒ†ãƒ ã‚’ç‰¹å®š
- **æ‹…å½“è€…ç‰¹å®š**: æ‹…å½“è€…ãƒãƒƒãƒ”ãƒ³ã‚°ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰è‡ªå‹•é¸å®š
- **å„ªå…ˆåº¦åˆ¤å®š**: CVSSã‚¹ã‚³ã‚¢ã¨æ¡ä»¶ã§æœŸé™ã‚’æ±ºå®š
- **æ‹…å½“è€…é€šçŸ¥**: Google Chatã«ã‚«ãƒ¼ãƒ‰å½¢å¼ã§ã‚¢ãƒ©ãƒ¼ãƒˆé€ä¿¡
- **A2Aé€£æº**: Jira / æ‰¿èª / ãƒ‘ãƒƒãƒ / ãƒ¬ãƒãƒ¼ãƒˆãªã©åˆ¥ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé€£æº
- **éŸ³å£°/ãƒãƒ£ãƒƒãƒˆUI**: Gemini Live API ã‚’ä½¿ã£ãŸãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¯¾è©±

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Vertex AI Agent Engine                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     Vulnerability Management Agent (gemini-2.5-flash) â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚
â”‚  â”‚   â”‚Gmail Toolsâ”‚  â”‚Sheets Toolâ”‚  â”‚Chat Tools â”‚        â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼              â–¼              â–¼
        Gmail API     Google Sheets    Google Chat
        (SIDfmç›£è¦–)   (SBOM/æ‹…å½“è€…)    (é€šçŸ¥é€ä¿¡)
```

### éŸ³å£°/ãƒãƒ£ãƒƒãƒˆUIã®è¿½åŠ æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Web Client                             â”‚
â”‚   - text chat UI / mic capture (Barge-inå¯¾å¿œ)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Live Gateway (Cloud Run)                      â”‚
â”‚   - Gemini Live API ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†                           â”‚
â”‚   - Agent Engine ã¸ã®ãƒ†ã‚­ã‚¹ãƒˆå•ã„åˆã‚ã›                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ Vertex AI SDK
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Vertex AI Agent Engine                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
.
â”œâ”€â”€ agent/                # Vertex AI Agent Engineå‘ã‘ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ agent.py           # ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®šç¾©ã¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
â”‚   â””â”€â”€ tools/             # Gmail / Sheets / Chat / A2A ãƒ„ãƒ¼ãƒ«ç¾¤
â”œâ”€â”€ scheduler/             # Cloud Scheduler ã‹ã‚‰ã®å®šæœŸå®Ÿè¡Œ
â”œâ”€â”€ live_gateway/          # WebSocket + Gemini Live API ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤
â”œâ”€â”€ web/                   # ãƒ–ãƒ©ã‚¦ã‚¶ç”¨ãƒãƒ£ãƒƒãƒˆUI
â”œâ”€â”€ docs/                  # ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰
â”œâ”€â”€ deploy.sh              # ADK CLIã«ã‚ˆã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ deploy_python.py       # Pythonã«ã‚ˆã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â””â”€â”€ setup_gmail_oauth.py   # Gmail OAuthãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
```

## ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### 1) ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæœ¬ä½“ (`agent/`)
- `agent.py` ãŒã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã€ãƒ„ãƒ¼ãƒ«å®šç¾©ã€A2Aé€£æºã‚’ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚
- Gmail / Sheets / Chat / A2A ç”¨ãƒ„ãƒ¼ãƒ«ã‚’FunctionToolã¨ã—ã¦ç™»éŒ²ã€‚

### 2) Gmailé€£æº (`agent/tools/gmail_tools.py`)
- OAuthãƒˆãƒ¼ã‚¯ãƒ³ / ãƒ‰ãƒ¡ã‚¤ãƒ³å§”ä»» / ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆèªè¨¼ã®è‡ªå‹•åˆ¤å®šã€‚
- SIDfmæœªèª­ãƒ¡ãƒ¼ãƒ«ã‚’å–å¾—ã—ã¦è§£æã—ã¾ã™ã€‚

### 3) Sheetsé€£æº (`agent/tools/sheets_tools.py`)
- SBOMã¨æ‹…å½“è€…ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’èª­ã¿è¾¼ã¿ã€PURLãƒãƒƒãƒã§æ‹…å½“è€…ã‚’ç‰¹å®šã€‚
- 5åˆ†ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æŒã¤ãŸã‚ã€é »ç¹ãªå‘¼ã³å‡ºã—ã§ã‚‚é«˜é€Ÿã§ã™ã€‚

### 4) Chaté€£æº (`agent/tools/chat_tools.py`)
- Google Chatã¸ã®ã‚¢ãƒ©ãƒ¼ãƒˆé€ä¿¡ã¨ã‚«ãƒ¼ãƒ‰æç”»ã€‚
- é‡å¤§åº¦ã«å¿œã˜ãŸå¯¾å¿œæœŸé™ã‚’è‡ªå‹•è¨ˆç®—ã—ã¾ã™ã€‚

### 5) A2Aé€£æº (`agent/tools/a2a_tools.py`)
- ä»–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ç™»éŒ²ãƒ»å‘¼ã³å‡ºã—ã®ãŸã‚ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼ã€‚
- Jiraãƒã‚±ãƒƒãƒˆä½œæˆã‚„æ‰¿èªç”³è«‹ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ§‹ç¯‰ã«ã‚‚å¯¾å¿œã€‚

### 6) å®šæœŸå®Ÿè¡Œ (`scheduler/`)
- Cloud Scheduler â†’ Cloud Functions â†’ Agent Engine ã®æ§‹æˆã§å®šæœŸã‚¹ã‚­ãƒ£ãƒ³ã€‚
- `run_vulnerability_scan` ãŒã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚

### 7) Live Gateway (`live_gateway/`)
- WebSocketçµŒç”±ã§ãƒ†ã‚­ã‚¹ãƒˆ/éŸ³å£°ã‚’å—ã‘ã€Agent Engineã«è»¢é€ã€‚
- Gemini Live APIã‚’ä½¿ã£ãŸéŸ³å£°æ›¸ãèµ·ã“ã—ãƒ»éŸ³å£°å¿œç­”ã‚’ç®¡ç†ã€‚

### 8) Web UI (`web/`)
- ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰WebSocketã§æ¥ç¶šã—ã€ãƒ†ã‚­ã‚¹ãƒˆ/éŸ³å£°å¯¾è©±ãŒå¯èƒ½ã€‚
- éŸ³å£°ã®ãƒãƒ¼ã‚¸ã‚¤ãƒ³ï¼ˆå‰²ã‚Šè¾¼ã¿ï¼‰ã«ã‚‚å¯¾å¿œã€‚

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— & ãƒ‡ãƒ—ãƒ­ã‚¤å‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ä»¥ä¸‹ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’æº€ãŸã—ã¦ã„ã‚Œã°ã€Google Cloud ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã‚‚å•é¡Œãªãå‹•ä½œã—ã¾ã™ã€‚

### 1) å¿…é ˆã®ç’°å¢ƒå¤‰æ•°

`agent/.env` ã«è¨­å®šã—ã¾ã™ï¼ˆ`deploy.sh` ãŒãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¾ã™ï¼‰ã€‚

```bash
# å…±é€š
GCP_PROJECT_ID=your-project-id
GCP_LOCATION=asia-northeast1
AGENT_RESOURCE_NAME=projects/your-project/locations/asia-northeast1/reasoningEngines/AGENT_ID

# Gmailï¼ˆOAuth or Workspaceï¼‰
GMAIL_OAUTH_TOKEN=...               # å€‹äººGmailã®ã¨ãã®ã¿
GMAIL_USER_EMAIL=security@domain    # Workspaceå§”ä»»ã®ã¨ãã®ã¿
SIDFM_SENDER_EMAIL=noreply@sidfm.com

# Sheets
SBOM_SPREADSHEET_ID=your-spreadsheet-id
SBOM_SHEET_NAME=SBOM
OWNER_SHEET_NAME=æ‹…å½“è€…ãƒãƒƒãƒ”ãƒ³ã‚°

# Chat
DEFAULT_CHAT_SPACE_ID=spaces/AAAA_BBBBB

# BigQueryï¼ˆå¯¾å¿œå±¥æ­´ã®ä¿å­˜ï¼‰
BQ_HISTORY_TABLE_ID=your-project.your_dataset.incident_response_history

# Live API
GEMINI_API_KEY=your-gemini-api-key
GEMINI_LIVE_MODEL=gemini-2.0-flash-live-001

# A2Aï¼ˆä»»æ„ï¼‰
REMOTE_AGENT_JIRA=projects/your-project/locations/us-central1/reasoningEngines/jira-agent-id
REMOTE_AGENT_APPROVAL=projects/your-project/locations/us-central1/reasoningEngines/approval-agent-id
REMOTE_AGENT_PATCH=projects/your-project/locations/us-central1/reasoningEngines/patch-agent-id
REMOTE_AGENT_REPORT=projects/your-project/locations/us-central1/reasoningEngines/report-agent-id
```

### 2) å¿…è¦ãªAPI/æ¨©é™

æœ€å°æ§‹æˆã§å¿…è¦ãªAPI:

- Gmail API
- Google Sheets API
- Google Chat API
- Vertex AI / Agent Engine
- (Live Gateway ã‚’ä½¿ã†å ´åˆ) Gemini Live API

ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«å¿…è¦ãªæ¨©é™ä¾‹:

- `roles/aiplatform.user`ï¼ˆAgent Engine å‘¼ã³å‡ºã—ï¼‰
- `roles/iam.serviceAccountUser`ï¼ˆCloud Functions/Runãªã©ã§ã®å®Ÿè¡Œï¼‰
- Gmail/Chat/Sheets APIã«å¿…è¦ãªã‚¢ã‚¯ã‚»ã‚¹æ¨©

### 3) ç–é€šç¢ºèªï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤å¾Œï¼‰

```bash
./test_agent.sh "Gmailã¸ã®æ¥ç¶šã‚’ç¢ºèªã—ã¦"
./test_agent.sh "Chatæ¥ç¶šã‚’ç¢ºèªã—ã¦"
./test_agent.sh "æœªèª­ãƒ¡ãƒ¼ãƒ«ã‚’3ä»¶å–å¾—ã—ã¦"
```

---

## RAG / ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã®è¿½åŠ ã‚¢ã‚¤ãƒ‡ã‚¢

æ—¢å­˜ã®ãƒ•ãƒ­ãƒ¼ï¼ˆGmail â†’ SBOM/æ‹…å½“è€… â†’ Chaté€šçŸ¥ï¼‰ã«ãƒ—ãƒ©ã‚¹ã‚¢ãƒ«ãƒ•ã‚¡ã§ã€RAGã‚„ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’æ´»ç”¨ã™ã‚‹å ´åˆã®æ–¹å‘æ€§ã§ã™ã€‚

### 1) RAGï¼ˆæ¤œç´¢æ‹¡å¼µç”Ÿæˆï¼‰

**ç›®çš„**: è„†å¼±æ€§é€šçŸ¥ã«å¯¾ã—ã¦ã€ã‚ˆã‚Šæ ¹æ‹ ã®ã‚ã‚‹èª¬æ˜ã‚„åˆ¤æ–­ææ–™ã‚’æ·»ãˆã‚‹ã€‚

- **è¿½åŠ ã™ã‚‹ãƒ‡ãƒ¼ã‚¿æºã®ä¾‹**
  - è£½å“ã”ã¨ã®é‹ç”¨æ‰‹é †ãƒ»SOPï¼ˆDocs/Confluenceï¼‰
  - éå»ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã®å¯¾å¿œå±¥æ­´ï¼ˆãƒã‚±ãƒƒãƒˆ/ãƒ¬ãƒãƒ¼ãƒˆ/DBï¼‰
  - ç¤¾å†…ã®ä¾‹å¤–ãƒãƒªã‚·ãƒ¼ï¼ˆä¾‹: é€±æœ«ã¯å¯¾å¿œæ–¹é‡ãŒç•°ãªã‚‹ ãªã©ï¼‰
- **å…·ä½“çš„ãªä½¿ã„æ–¹**
  - ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒã€Œå¯¾è±¡PURL / å½±éŸ¿ã‚·ã‚¹ãƒ†ãƒ ã€ã‚’ç‰¹å®šã—ãŸå¾Œã«ã€
    **RAGã§ã€Œå¯¾å¿œæ‰‹é †ã€ã€Œä¾‹å¤–ãƒ«ãƒ¼ãƒ«ã€ã€Œéå»ã®é¡ä¼¼å¯¾å¿œã€ã‚’å–å¾—**
  - Chaté€šçŸ¥ã‚«ãƒ¼ãƒ‰ã«ã€Œå‚è€ƒãƒªãƒ³ã‚¯ã€ã‚„ã€Œæ¨å¥¨æ‰‹é †ã€ã‚’è‡ªå‹•è¿½è¨˜
- **æœ€ä½é™ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³**
  - æ—¢å­˜ã®Sheets/SBOMå‚ç…§ã«åŠ ãˆã¦ã€ç¤¾å†…ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚„å¯¾å¿œå±¥æ­´ã‚’
    **ãƒ™ã‚¯ã‚¿DBï¼ˆVertex AI Matching Engine ãªã©ï¼‰ã«æ ¼ç´**ã—æ¤œç´¢
  - ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ `search_knowledge_base()` ã‚’è¿½åŠ ã—ã€
    è¿”å´çµæœã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«å·®ã—è¾¼ã‚€
- **å¯¾å¿œå±¥æ­´ã‚’BigQueryã§è“„ç©ã™ã‚‹å ´åˆã®è€ƒãˆæ–¹**
  - **æ–¹å‘æ€§ã¯å¦¥å½“**ã€‚å¯¾å¿œå±¥æ­´ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«é›†ç´„ã™ã‚‹ã“ã¨ã§ã€
    äººé–“ã®æ¤œç´¢ãƒ»é›†è¨ˆã«ã‚‚ä½¿ãˆã€RAGã®æ¤œç´¢å…ƒã«ã‚‚ã§ãã‚‹
  - å…¸å‹çš„ã«ã¯ã€ŒBigQueryã«æ ¼ç´ â†’ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã—ã¦æ¤œç´¢ã€
    ã®2æ®µæ§‹æˆã«ã™ã‚‹ã®ãŒæ‰±ã„ã‚„ã™ã„
  - BigQueryè‡ªä½“ã¯åˆ†æãƒ»é›†è¨ˆã«å¼·ã„ã®ã§ã€**äººé–“å‘ã‘ã®ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹**
    ã¨ã—ã¦ã‚‚æœ‰åŠ¹ã€‚RAGå‘ã‘ã«ã¯ã€èª¬æ˜æ–‡ã‚„è¦ç´„ã‚’åˆ¥ã‚«ãƒ©ãƒ ã¨ã—ã¦æŒã¤ã¨ä¾¿åˆ©
  - ã¾ãšã¯ **BigQueryã‚’å˜ä¸€ã®æƒ…å ±æºï¼ˆSSOTï¼‰** ã«ã—ã€
    RAGç”¨ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¯å¿…è¦ã«å¿œã˜ã¦æ´¾ç”Ÿã•ã›ã‚‹ã®ãŒé‹ç”¨ã—ã‚„ã™ã„
- **æœ¬ãƒªãƒã‚¸ãƒˆãƒªã§ã®å®Ÿè£…å†…å®¹ï¼ˆå¯¾å¿œå±¥æ­´ã®ä¿å­˜ï¼‰**
  - `log_vulnerability_history()` ãƒ„ãƒ¼ãƒ«ã§ã€å¯¾å¿œå±¥æ­´ã‚’BigQueryã«è¡Œè¿½åŠ 
  - `send_vulnerability_alert()` ã®é€ä¿¡æˆåŠŸæ™‚ã«å±¥æ­´ä¿å­˜ã‚’è‡ªå‹•å®Ÿè¡Œ
  - `BQ_HISTORY_TABLE_ID` ãŒæœªè¨­å®šã®å ´åˆã¯ä¿å­˜ã‚’ã‚¹ã‚­ãƒƒãƒ—

### 2) ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°

**ç›®çš„**: æ–‡ç« ã®ãƒˆãƒ¼ãƒ³ã‚„åˆ¤æ–­åŸºæº–ã‚’ç¤¾å†…ãƒ«ãƒ¼ãƒ«ã«åˆã‚ã›ã¦å®‰å®šåŒ–ã™ã‚‹ã€‚

- **å‘ã„ã¦ã„ã‚‹ç”¨é€”**
  - Chaté€šçŸ¥ã®æ–‡é¢ï¼ˆç·Šæ€¥åº¦ã”ã¨ã®è¨€ã„å›ã—ï¼‰
  - æœŸé™ã‚„å„ªå…ˆåº¦ã®åˆ¤å®šã«ãŠã‘ã‚‹ã€Œçµ„ç¹”ã®æš—é»™çŸ¥ã€ã®åæ˜ 
- **å®Ÿæ–½ã‚¹ãƒ†ãƒƒãƒ—ã®ä¾‹**
  - éå»ã®é€šçŸ¥æ–‡ãƒ»å¯¾å¿œçµæœã‹ã‚‰
    **ã€Œå…¥åŠ›ï¼ˆè„†å¼±æ€§ + å½±éŸ¿æƒ…å ±ï¼‰ã€â†’ã€Œå‡ºåŠ›ï¼ˆæ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼‰ã€**ã®
    å½¢å¼ã§å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
  - ä½é »åº¦ã§è‰¯ã„ã®ã§ã€çµ„ç¹”ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã«é™å®šã—ã¦å­¦ç¿’
- **é‹ç”¨ã®ãƒ’ãƒ³ãƒˆ**
  - ã¾ãšã¯ RAG ã§æ ¹æ‹ ï¼ˆãƒãƒªã‚·ãƒ¼ãƒ»æ‰‹é †ï¼‰ã‚’å‚ç…§ã—ã€
    ã€Œè¡¨ç¾ã®ä¸€è²«æ€§ã€ã¯ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã§è£œã†ã€ã¨ã„ã†ä½µç”¨ãŒå®‰å®š

---

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—è©³ç´°ã‚¬ã‚¤ãƒ‰ï¼ˆçµ±åˆç‰ˆï¼‰

ä»¥ä¸‹ã¯ `docs/` å†…ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰ã‚’ README ã«çµ±åˆã—ãŸã‚‚ã®ã§ã™ã€‚

### å¿…é ˆã®ç’°å¢ƒå¤‰æ•°ï¼ˆä¾‹ï¼‰

`agent/.env` ã«è¨­å®šã—ã¾ã™ï¼ˆ`deploy.sh` ãŒãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¾ã™ï¼‰ã€‚

```
GMAIL_USER_EMAIL=security-team@your-domain.com
SIDFM_SENDER_EMAIL=noreply@sidfm.com
SBOM_SPREADSHEET_ID=your-spreadsheet-id
SBOM_SHEET_NAME=SBOM
OWNER_SHEET_NAME=æ‹…å½“è€…ãƒãƒƒãƒ”ãƒ³ã‚°
DEFAULT_CHAT_SPACE_ID=spaces/your-space-id
```

## Gmailé€£æºï¼ˆå€‹äººGmailï¼‰ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### Step 1: OAuth ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã®ä½œæˆ

1. https://console.cloud.google.com/apis/credentials
2. ã€Œèªè¨¼æƒ…å ±ã‚’ä½œæˆã€â†’ã€ŒOAuth ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã€
3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¨®é¡: **ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒª**
4. åå‰: `vuln-agent-gmail`
5. JSON ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ `credentials.json` ã«ãƒªãƒãƒ¼ãƒ 

```bash
mv ~/Downloads/client_secret_xxx.json /path/to/vuln-agent/credentials.json
```

### Step 2: Gmail API æœ‰åŠ¹åŒ–

https://console.cloud.google.com/apis/library/gmail.googleapis.com ã‚’æœ‰åŠ¹åŒ–

### Step 3: OAuth åŒæ„ç”»é¢ã®è¨­å®š

1. https://console.cloud.google.com/apis/credentials/consent
2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¿ã‚¤ãƒ—: **å¤–éƒ¨**ï¼ˆå€‹äººGmailã®å ´åˆï¼‰
3. ã‚¹ã‚³ãƒ¼ãƒ—ã« `https://www.googleapis.com/auth/gmail.modify` ã‚’è¿½åŠ 
4. ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆ©ç”¨ã™ã‚‹Gmailã‚’è¿½åŠ ï¼ˆå¿…é ˆï¼‰

### Step 4: ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ

```bash
python setup_gmail_oauth.py
```

### Step 5: å†ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
./deploy.sh
```

---

## Google Chat é€šçŸ¥ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### Step 1: Chat API æœ‰åŠ¹åŒ–

https://console.cloud.google.com/apis/library/chat.googleapis.com ã‚’æœ‰åŠ¹åŒ–

### Step 2: Chat Bot è¨­å®š

https://console.cloud.google.com/apis/api/chat.googleapis.com/hangouts-chat

| é …ç›® | å€¤ |
|------|-----|
| ã‚¢ãƒ—ãƒªå | è„†å¼±æ€§ç®¡ç†Bot |
| èª¬æ˜ | è„†å¼±æ€§é€šçŸ¥ã‚’é€ä¿¡ã™ã‚‹Bot |
| ã‚¹ãƒšãƒ¼ã‚¹ã¨ã‚°ãƒ«ãƒ¼ãƒ—ã®ä¼šè©±ã§ã‚¢ãƒ—ãƒªã‚’æœ‰åŠ¹åŒ– | âœ… |
| 1:1 ã§ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å—ä¿¡ | âœ…ï¼ˆä»»æ„ï¼‰ |
| å…¬é–‹è¨­å®š | ç‰¹å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ |

### Step 3: ã‚¹ãƒšãƒ¼ã‚¹ã« Bot ã‚’è¿½åŠ 

Google Chatä¸Šã§ã‚¹ãƒšãƒ¼ã‚¹ã‚’ä½œæˆã—ã€Botã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

### Step 4: ã‚¹ãƒšãƒ¼ã‚¹IDã‚’å–å¾—

URLã® `room/` ä»¥é™ãŒIDã§ã™ã€‚ç’°å¢ƒå¤‰æ•°ã«ã¯ `spaces/XXXX` å½¢å¼ã§è¨­å®šã—ã¾ã™ã€‚

### Step 5: ç’°å¢ƒå¤‰æ•°è¿½åŠ  & å†ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
DEFAULT_CHAT_SPACE_ID=spaces/AAAA_BBBBB
./deploy.sh
```

---

## å®šæœŸå®Ÿè¡Œï¼ˆCloud Scheduler + Cloud Functionsï¼‰

### ç°¡å˜ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆæ¨å¥¨ï¼‰

```bash
gcloud ai reasoning-engines list --location=asia-northeast1
./setup_scheduler.sh
```

### æ‰‹å‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

1) APIæœ‰åŠ¹åŒ–

```bash
gcloud services enable cloudfunctions.googleapis.com
gcloud services enable cloudscheduler.googleapis.com
gcloud services enable cloudbuild.googleapis.com
gcloud services enable run.googleapis.com
```

2) ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã¨æ¨©é™ä»˜ä¸

```bash
PROJECT_ID=$(gcloud config get-value project)
gcloud iam service-accounts create vuln-agent-scheduler-sa \
  --display-name="Vulnerability Agent Scheduler"
gcloud projects add-iam-policy-binding $PROJECT_ID \
  --member="serviceAccount:vuln-agent-scheduler-sa@${PROJECT_ID}.iam.gserviceaccount.com" \
  --role="roles/aiplatform.user"
```

3) Cloud Functions ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
cd scheduler
gcloud functions deploy vuln-agent-scheduler \
  --gen2 \
  --runtime=python312 \
  --region=asia-northeast1 \
  --source=. \
  --entry-point=run_vulnerability_scan \
  --trigger-http \
  --allow-unauthenticated=false \
  --service-account="vuln-agent-scheduler-sa@${PROJECT_ID}.iam.gserviceaccount.com" \
  --set-env-vars="GCP_PROJECT_ID=${PROJECT_ID},GCP_LOCATION=asia-northeast1,AGENT_RESOURCE_NAME=projects/${PROJECT_ID}/locations/asia-northeast1/reasoningEngines/YOUR_AGENT_ID" \
  --memory=512MB \
  --timeout=540s
cd ..
```

4) Cloud Scheduler ã‚¸ãƒ§ãƒ–ä½œæˆ

```bash
FUNCTION_URL=$(gcloud functions describe vuln-agent-scheduler \
  --region=asia-northeast1 \
  --format='value(serviceConfig.uri)')
gcloud scheduler jobs create http vuln-agent-scan \
  --location=asia-northeast1 \
  --schedule="0 * * * *" \
  --time-zone="Asia/Tokyo" \
  --uri="$FUNCTION_URL" \
  --http-method=POST \
  --oidc-service-account-email="vuln-agent-scheduler-sa@${PROJECT_ID}.iam.gserviceaccount.com" \
  --oidc-token-audience="$FUNCTION_URL"
```

---

## A2Aé€£æºï¼ˆAgent-to-Agentï¼‰

### 1) é€£æºã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤

ä¾‹: Jiraé€£æºã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ

```python
from google.adk import Agent
from google.adk.tools import FunctionTool

def create_jira_ticket(...):
    ...

agent = Agent(
    name="jira_agent",
    model="gemini-2.5-flash",
    instruction="Jiraãƒã‚±ãƒƒãƒˆã‚’ä½œæˆã™ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ",
    tools=[FunctionTool(create_jira_ticket)],
)
```

```bash
adk deploy --project=YOUR_PROJECT --location=us-central1
```

### 2) ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

```bash
REMOTE_AGENT_JIRA=projects/your-project/locations/us-central1/reasoningEngines/jira-agent-id
REMOTE_AGENT_APPROVAL=projects/your-project/locations/us-central1/reasoningEngines/approval-agent-id
REMOTE_AGENT_PATCH=projects/your-project/locations/us-central1/reasoningEngines/patch-agent-id
REMOTE_AGENT_REPORT=projects/your-project/locations/us-central1/reasoningEngines/report-agent-id
```

### 3) å‹•ä½œç¢ºèª

```bash
./test_agent.sh "ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æ•™ãˆã¦"
```

---

## Live API + Web UIï¼ˆéŸ³å£°å¯¾è©±ï¼‰

### 1) Live Gateway ã‚’ãƒ­ãƒ¼ã‚«ãƒ«èµ·å‹•

```bash
cd live_gateway
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt

export GCP_PROJECT_ID=YOUR_PROJECT_ID
export GCP_LOCATION=asia-northeast1
export AGENT_RESOURCE_NAME=projects/PROJECT/locations/asia-northeast1/reasoningEngines/AGENT_ID
export GEMINI_API_KEY=YOUR_API_KEY
export GEMINI_LIVE_MODEL=gemini-2.0-flash-live-001

python app.py
```

### 2) Web UI ã‚’èµ·å‹•

```bash
cd web
python -m http.server 8081
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://localhost:8081` ã‚’é–‹ãã€Gateway URL ã«
`ws://localhost:8000/ws` ã‚’æŒ‡å®šã—ã¦æ¥ç¶šã—ã¾ã™ã€‚

### 3) Cloud Run ã¸ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
cd live_gateway
gcloud run deploy vuln-agent-live-gateway \
  --source=. \
  --region=asia-northeast1 \
  --set-env-vars=GCP_PROJECT_ID=YOUR_PROJECT_ID,GCP_LOCATION=asia-northeast1,AGENT_RESOURCE_NAME=projects/PROJECT/locations/asia-northeast1/reasoningEngines/AGENT_ID,GEMINI_API_KEY=YOUR_API_KEY \
  --allow-unauthenticated
```

### 4) Web UI ã®ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ï¼ˆGCSä¾‹ï¼‰

```bash
gsutil mb gs://YOUR_PROJECT_ID-live-ui
gsutil web set -m index.html -e index.html gs://YOUR_PROJECT_ID-live-ui
gsutil rsync -R web gs://YOUR_PROJECT_ID-live-ui
```

å…¬é–‹URLã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€Cloud Run ã® `wss://.../ws` ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

---

## ãƒ‡ãƒ—ãƒ­ã‚¤

### ADK CLIã§ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
GCP_PROJECT_ID=your-project-id \
STAGING_BUCKET=gs://your-staging-bucket \
./deploy.sh
```

### Pythonã§ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
python deploy_python.py \
  --project your-project-id \
  --location asia-northeast1 \
  --staging-bucket gs://your-staging-bucket
```

## å‹•ä½œç¢ºèª

```bash
./test_agent.sh "Gmailã¸ã®æ¥ç¶šã‚’ç¢ºèªã—ã¦"
```

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯ç¾æ™‚ç‚¹ã§æ˜ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚å¿…è¦ã«å¿œã˜ã¦è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
