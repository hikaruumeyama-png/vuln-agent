<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Vulnerability Agent</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="app-layout">
      <!-- Header -->
      <header class="app-header">
        <div class="header-left">
          <div class="app-logo">
            <i data-lucide="shield" class="logo-icon"></i>
            <div>
              <h1 class="app-title">Vulnerability Agent</h1>
              <p class="app-subtitle">AI-powered vulnerability management</p>
            </div>
          </div>
        </div>
        <div class="header-right">
          <div class="connection-badge" id="connection-badge">
            <span class="connection-dot" id="status-indicator"></span>
            <span class="connection-label" id="status-text">Disconnected</span>
          </div>
          <div class="connection-metrics">
            <span id="ping-latency">Ping: -- ms</span>
            <span id="reconnect-count">Reconnects: 0</span>
          </div>
        </div>
      </header>

      <!-- Connection bar -->
      <section class="connection-bar">
        <div class="connection-form">
          <div class="url-input-group">
            <i data-lucide="link" class="input-icon"></i>
            <input
              id="gateway-url"
              type="url"
              placeholder="wss://your-gateway-url/ws"
              class="url-input"
            />
          </div>
          <button id="connect-button" class="btn btn-primary">
            <i data-lucide="wifi"></i>
            <span>Connect</span>
          </button>
          <button id="disconnect-button" class="btn btn-outline" disabled>
            <i data-lucide="wifi-off"></i>
            <span>Disconnect</span>
          </button>
        </div>
      </section>

      <!-- Main content: two-panel layout -->
      <div class="main-content">
        <!-- Left: Chat panel -->
        <section class="chat-panel">
          <div class="panel-header">
            <i data-lucide="message-square"></i>
            <span>Chat</span>
          </div>
          <div id="messages" class="messages-area"></div>

          <!-- Audio controls -->
          <div class="audio-bar" id="audio-bar">
            <button id="start-audio" class="btn btn-audio" disabled title="Start Audio">
              <i data-lucide="mic"></i>
            </button>
            <button id="stop-audio" class="btn btn-audio btn-audio-stop" disabled title="Stop Audio">
              <i data-lucide="mic-off"></i>
            </button>
            <div class="voice-orb voice-orb-idle" id="voice-orb" aria-label="Agent voice status">
              <div class="voice-orb-core"></div>
              <div class="voice-orb-ring"></div>
            </div>
            <div class="audio-level-container" id="audio-level-container">
              <div class="audio-level-bar" id="audio-level-bar"></div>
            </div>
            <span id="audio-status" class="audio-status-text">Idle</span>
          </div>

          <!-- Chat input -->
          <form id="chat-form" class="chat-input-form">
            <textarea
              id="chat-input"
              placeholder="脆弱性について質問してください (Enterで送信 / Shift+Enterで改行)"
              required
              rows="1"
            ></textarea>
            <button type="submit" class="btn btn-send" title="Send">
              <i data-lucide="send"></i>
            </button>
          </form>
        </section>

        <!-- Right: Agent activity panel -->
        <section class="activity-panel" id="activity-panel">
          <div class="panel-header">
            <i data-lucide="activity"></i>
            <span>Agent Activity</span>
            <div class="activity-meta" id="activity-meta">
              <span id="activity-request-id">Request: -</span>
              <span id="activity-progress">Progress: 0/0</span>
              <span id="activity-step">Step: Idle</span>
            </div>
            <button class="btn-icon" id="clear-activity" title="Clear">
              <i data-lucide="x"></i>
            </button>
          </div>
          <div id="activity-feed" class="activity-feed">
            <div class="activity-empty">
              <i data-lucide="bot" class="empty-icon"></i>
              <p>リクエスト処理時にエージェントの動作がここに表示されます。</p>
            </div>
          </div>
        </section>
      </div>
    </div>
    <div class="voice-session-overlay" id="voice-session-overlay" aria-live="polite">
      <div class="voice-session-content">
        <div class="voice-orb-large" id="voice-orb-large">
          <svg class="voice-orb-large-svg" viewBox="-120 -120 240 240" aria-hidden="true">
            <path id="voice-orb-large-path" class="voice-orb-large-path"></path>
          </svg>
        </div>
        <div class="voice-session-label" id="voice-session-label">Agent Greeting...</div>
        <button id="voice-session-close" class="btn btn-outline voice-session-close" type="button">
          <i data-lucide="x-circle"></i>
          <span>対話を終了</span>
        </button>
      </div>
    </div>
    <div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true"></div>

    <script src="https://unpkg.com/lucide@0.460.0/dist/umd/lucide.min.js"></script>
    <script src="app.js"></script>
  </body>
</html>
